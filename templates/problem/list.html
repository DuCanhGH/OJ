{% extends "common-content.html" %}

{% block media %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider/dist/nouislider.min.css">
    <noscript>
        <style>#category, #types {
            visibility: visible;
        }
        </style>
    </noscript>
    <style>
        #problem-table th {
            padding: 0;
        }
    </style>
{% endblock %}

{% block js_media %}
    {% compress js %}
        <script 
            src="{{ static('bundled/problem/list.js') }}"
            data-point-start="{{ point_start }}"
            data-point-end="{{ point_end }}"
            data-point-values="{{ point_values|json|safe }}"
            data-select2-theme="{{ DMOJ_SELECT2_THEME }}"
        ></script>
    {% endcompress %}
{% endblock %}

{% block title_ruler %}{% endblock %}

{% block title_row %}
    {% set tab = 'list' %}
    {% include "problem/problem-list-tabs.html" %}
{% endblock %}

{% block body %}
    {% if page_obj.has_other_pages() %}
        <div class="top-pagination-bar">{% include "list-pages.html" %}</div>
    {% endif %}

    <div id="common-content">
        {% block before_table %}{% endblock %}
        <div id="content-right" class="problems">
            <div class="info-float">
                {% include "problem/search-form.html" %}
                {% if hot_problems %}
                    <div class="sidebox">
                        <h3>{{ _('Hot problems') }} <i class="fa fa-fire"></i></h3>
                        <div class="sidebox-content">
                            <ul class="problem-list">{% for problem in hot_problems %}
                                <li><a href="{{ url('problem_detail', problem.code) }}" class="hot-problem-link">
                                    {{ problem.name }}
                                </a></li>
                            {% endfor %}</ul>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        <div id="content-left" class="problems h-scrollable-table">
            <table id="problem-table" class="table striped">
                <thead>
                <tr>
                    {% if request.user.is_authenticated %}
                        <th class="solved">
                            <a href="{{ sort_links.solved }}">
                                <i class="fa fa-check"></i>{{ sort_order.solved }}
                            </a>
                        </th>
                    {% endif %}
                    <th class="problem-code">
                        <a href="{{ sort_links.code }}">{{ _('ID') }}{{ sort_order.code}}</a>
                    </th>
                    <th class="problem-name">
                        <a href="{{ sort_links.name }}">{{ _('Problem') }}{{ sort_order.name }}</a>
                    </th>
                    <th class="category">
                        <a href="{{ sort_links.group }}">{{ _('Category') }}{{ sort_order.group }}</a>
                    </th>
                    {% if show_types %}
                        <th class="types">
                            <a href="{{ sort_links.type }}">{{ _('Types') }}{{ sort_order.type }}</a>
                        </th>
                    {% endif %}
                    <th class="points">
                        <a href="{{ sort_links.points }}">{{ _('Points') }}{{ sort_order.points }}</a>
                    </th>
                    <th class="ac-rate">
                        <a href="{{ sort_links.ac_rate }}">{{ _('%% AC') }}{{ sort_order.ac_rate }}</a>
                    </th>
                    <th class="users">
                        <a href="{{ sort_links.user_count }}">{{ _('# AC') }}{{ sort_order.user_count }}</a>
                    </th>
                    <th class="editorial" title="{{ _('Editorial') }}">
                        <a href="{{ sort_links.editorial }}">
                            <i class="fa fa-book"></i>{{ sort_order.editorial }}
                        </a>
                    </th>
                </tr>
                </thead>
                <tbody>
                {% for problem in problems %}
                    <tr>
                        {% if request.user.is_authenticated %}
                            {% if problem.id in completed_problem_ids %}
                                <td class="solved" solved="1">
                                    <a href="{{ url('user_submissions', problem.code, request.user.username) }}">
                                        {% if problem.is_public %}
                                            <i class="solved-problem-color fa fa-check-circle"></i>
                                        {% else %}
                                            <i class="solved-problem-color fa fa-lock"></i>
                                        {% endif %}
                                    </a>
                                </td>
                            {% elif problem.id in attempted_problems %}
                                <td class="solved" solved="0">
                                    <a href="{{ url('user_submissions', problem.code, request.user.username) }}">
                                        {% if problem.is_public %}
                                            <i class="attempted-problem-color fa fa-frown-o"></i>
                                        {% else %}
                                            <i class="attempted-problem-color fa fa-lock"></i>
                                        {% endif %}
                                    </a>
                                </td>
                            {% else %}
                                <td class="solved" solved="-1">
                                    {% if problem.is_public %}
                                        <i class="unsolved-problem-color fa"></i>
                                    {% else %}
                                        <i class="unsolved-problem-color fa fa-lock"></i>
                                    {% endif %}
                                </td>
                            {% endif %}
                        {% endif %}
                        <td class="problem-code">
                            <a href="{{ url('problem_detail', problem.code) }}">{{ problem.code}}</a>
                        </td>
                        <td class="problem-name">
                            <a href="{{ url('problem_detail', problem.code) }}">{{ problem.i18n_name or problem.name }}</a>
                        </td>
                        <td class="category">{{ problem.group.full_name }}</td>
                        {% if show_types %}
                            <td class="types">
                                {% for type in problem.types_list %}
                                    <span class="type-tag">{{ type }}</span>{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </td>
                        {% endif %}
                        <td class="p">{{ problem.points|floatformat(2) }}</td>
                        <td class="ac-rate">{{ problem.ac_rate|floatformat(1) }}%</td>
                        <td class="users">
                            <a href="{{ url('ranked_submissions', problem.code) }}">
                                {{ problem.user_count }}
                            </a>
                        </td>
                        <td>
                            {% if problem.has_public_editorial %}
                                <a href="{{ url('problem_editorial', problem.code) }}">
                                    <i class="has-editorial-color fa fa-check-circle"></i>
                                </a>
                            {% else %}
                                <i class="no-editorial-color fa fa-minus-circle"></i>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
   {% if page_obj.has_other_pages() %}
       <div class="bottom-pagination-bar">{% include "list-pages.html" %}</div>
   {% endif %}
{% endblock %}
