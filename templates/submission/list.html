{% extends "common-content.html" %}
{% block js_media %}
    {{ results_json|json_script:"results-json" }}
    {{ results_colors_json|json_script:"results-colors-json" }}

    {% compress js %}
        {% if request.user.is_authenticated and perms.judge.rejudge_submission %}
            <script 
                src="{{ static('bundled/submission/list/inject-rejudge.js') }}"
                data-submission-rejudge-url="{{ url('submission_rejudge') }}"
            ></script>
        {% endif %}

        <script 
            src="{{ static('bundled/submission/list/main.js') }}"
            data-dynamic-update="{{ 'true' if dynamic_update else 'false' }}" 
            data-paginator-per-page="{{ paginator.per_page }}"
            data-submission-single-query-url="{{ url('submission_single_query') }}"
            data-show-problem="{{ 'true' if show_problem else 'false' }}"
            data-select2-theme="{{ DMOJ_SELECT2_THEME }}"
            data-stats-update-time="{{ stats_update_interval|default(0) * 1000 }}"
            {% if EVENT_LAST_MSG %}
                data-event-last-message="{{ EVENT_LAST_MSG }}"
            {% endif %}
            {% if dynamic_contest_id %}
                data-dynamic-contest-id="{{ dynamic_contest_id }}"
            {% endif %}
            {% if dynamic_problem_id %}
                data-dynamic-problem-id="{{ dynamic_problem_id }}"
            {% endif %}
            {% if dynamic_user_id %}
                data-dynamic-user-id="{{ dynamic_user_id }}"
            {% endif %}
        ></script>
    {% endcompress %}

    {% if dynamic_update and EVENT_LAST_MSG %}
        <script src="{{ static('bundled/submission/list/enable-dynamic.js') }}"></script>
    {% endif %}
{% endblock %}

{% block title_ruler %}{% endblock %}

{% block title_row %}
    {% include "submission/submission-list-tabs.html" %}
{% endblock %}

{% block media %}
    {% if perms.judge.change_submission and perms.judge.rejudge_submission %}
        <style>
            td.sub-prop, col.sub-prop {
                width: 22%
            }

            col.sub-info, td.sub-info {
                width: 78%
            }

            #status, #language {
                visibility: hidden;
            }
        </style>
    {% endif %}

    <style>
        .total {
            text-align: center;
            margin-bottom: 0.5em;
        }

        #status-graph {
            padding: 1em 0em;
        }

        #status-graph canvas {
            display: block;
            margin: 0 auto;
        }
    </style>
{% endblock %}

{% block body %}
    {% if page_obj.has_other_pages() %}
        <div class="top-pagination-bar">{% include "list-pages.html" %}</div>
    {% endif %}

    <div id="common-content">
        <div id="content-right" class="submission">
            <div class="info-float">
                <div class="sidebox">
                    <h3>{{ _('Filter submissions') }} <i class="fa fa-search"></i></h3>
                    <div class="sidebox-content">
                        <form id="filter-form" name="form" action="{{ first_page_href }}" method="get">
                            <div class="filter-form-group">
                                <label for="status"><i>{{ _('Status') }}</i></label>
                                <select id="status" name="status" multiple>
                                    {% for id, name in all_statuses %}
                                        <option {% if id in selected_statuses %}selected{% endif %}
                                                value="{{ id }}">{{ name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="filter-form-group">
                                <label for="language"><i>{{ _('Language') }}</i></label>
                                <select id="language" name="language" multiple>
                                    {% for code, name in all_languages %}
                                        <option {% if code in selected_languages %}selected{% endif %}
                                                value="{{ code }}">{{ name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            {% if not organization %}
                                <div class="filter-form-group">
                                    <label for="organization"><i>{{ _('Organization') }}</i></label>
                                    <select id="organization" name="organization">
                                        <option value="">{{ _('All') }}</option>
                                        <option disabled="disabled">---</option>
                                        {% for code, name in all_organizations %}
                                            <option {% if code == selected_organization %}selected{% endif %}
                                                    value="{{ code }}">{{ name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            {% endif %}
                            <div class="form-submit-group">
                                <a id="go" onclick="form.submit()" class="button">{{ _('Go') }}</a>
                            </div>
                        </form>
                    </div>
                    <div id="statistics-table">
                        <h3>{{ _('Statistics') }} <i class="fa fa-pie-chart"></i></h3>
                        <div class="sidebox-content">
                            <div id="status-graph">
                                <canvas width="230" height="170"></canvas>
                            </div>
                            <div class="total">
                                {{ _('Total:') }} <span id="total-submission-count"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="content-left" class="submission">
            <div class="ws-closed">
                <a href="javascript:void(0)">{{ _('You were disconnected. Refresh to show latest updates.') }}</a>
            </div>

            <div id="submissions-table">
                {% set profile_id = request.profile.id if request.user.is_authenticated else 0 %}
                {% for submission in submissions %}
                    <div class="submission-row" id="{{ submission.id }}">
                        {% with problem_name=show_problem and (submission.problem.i18n_name or submission.problem.name) %}
                            {% include "submission/row.html" %}
                        {% endwith %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% if page_obj.has_other_pages() %}
        <div class="bottom-pagination-bar">{% include "list-pages.html" %}</div>
    {% endif %}
{% endblock %}

{% block bodyend %}
    {# Don't load MathJax from common-content! #}
{% endblock %}
