{% extends "submission/info-base.html" %}
{% block js_media %}
    {% if not submission.is_graded and EVENT_LAST_MSG %}
        <script 
            src="{{ static('bundled/submission/status/main.js') }}" 
            data-submission-id="{{ submission.id }}"
            data-submission-secret-id="{{ submission.id_secret }}"
            data-submission-testcases-query="{{ url('submission_testcases_query') }}"
        ></script>
    {% endif %}
    {% if not submission.is_graded %}
        <script src="{{ static('bundled/submission/status/abort.js') }}"></script>
    {% endif %}
{% endblock %}

{% block body %}
    <br>
    {% if not submission.language.file_only or request.user.is_superuser %}
        <div><a href="{{ url('submission_source', submission.id) }}">{{ _('View source') }}</a></div>
    {% endif %}
    {% if submission.language.file_only %}
        <div><a href="{{ url('submission_source_download', submission.id) }}">{{ _('Download') }}</a></div>
    {% endif %}
    {% if (request.user == submission.user.user or perms.judge.resubmit_other) and not submission.language.file_only %}
        <div><a href="{{ url('problem_submit', submission.problem.code, submission.id) }}">{{ _('Resubmit') }}</a></div>
    {% endif %}
    {% set can_edit = submission.problem.is_editable_by(request.user) %}
    {% if perms.judge.rejudge_submission and can_edit and not submission.is_locked %}
        <script src="{{ static('bundled/submission/status/rejudge.js') }}"></script>
        <div>
            <form action="{{ url('submission_rejudge') }}" method="post">
                {% csrf_token %}
                <a href="#" onclick="window.confirmAndRejudge(parentNode)">{{ _('Rejudge') }}</a>
                <input type="hidden" name="id" value="{{ submission.id }}">
                <input type="hidden" name="path" value="{{ url('submission_status', submission.id) }}">
            </form>
        </div>
    {% endif %}
    {% if can_edit and not submission.language.file_only %}
        <div><a href="{{ url('problem_submission_diff', submission.problem.code) }}?username={{ submission.user.user.username }}&highlight={{ submission.id }}">{{ _('Diff this submission') }}</a></div>
    {% endif %}

    <br>
    <hr class="half-hr">
    <br>

    <div id="test-cases">{% include "submission/status-testcases.html" %}</div>

    {% if not submission.is_graded %}
        {% if request.user == submission.user.user or perms.judge.abort_any_submission %}
            <div id="abort-button">
                <br>
                <hr class="half-hr">
                <br>
                <form action="{{ url('submission_abort', submission.id) }}" method="post"
                      title="{{ _('Press Ctrl-Enter or Command-Enter to abort.') }}">
                    {% csrf_token %}
                    <input style="float:left" type="submit" value="{{ _('Abort') }}" class="button">
                    <br><br>
                </form>
            </div>
        {% endif %}
    {% endif %}
{% endblock %}
